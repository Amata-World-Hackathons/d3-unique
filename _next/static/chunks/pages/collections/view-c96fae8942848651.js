(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[683],{95380:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/collections/view",function(){return c(18068)}])},90304:function(d,b,a){"use strict";a.d(b,{CU:function(){return h},m1:function(){return f}});var e=a(96257),c=a(15503),f="originals",g=(0,c.ZF)({apiKey:"AIzaSyA149SZLk5ja0n4fwJYXIGxutaEfsIoiUE",authDomain:"community-nfts.firebaseapp.com",projectId:"community-nfts",storageBucket:"community-nfts.appspot.com",messagingSenderId:"775740160154",appId:"1:775740160154:web:fcf6fbf183fcc321818723"});function h(){return(0,e.ad)(g)}},18068:function(f,b,a){"use strict";a.r(b),a.d(b,{default:function(){return G}});var g=a(47568),h=a(41799),i=a(69396),c=a(34051),j=a.n(c),k=a(85893),d=a(41664),l=a.n(d),m=a(11163),n=a(19),o=a(21940),p=a(57234),q=a(70173),r=a(23567),s=a(93293),t=a(84860),u=a(67294),v=a(69890),w=a(90304),e=a(94184),x=a.n(e),y=a(79446),z=a(87536),A=a(48764).Buffer,B=a(60424).web3FromSource,C=function(c){var f=c.modalInputId,C=c.collectionId,d=c.parentTokenId,D=c.onMintSuccess,E=(0,w.CU)();(0,m.useRouter)();var l,F=(0,v.Yk)(),G=(0,r.ZO)(),a=(0,z.cI)(),o=a.handleSubmit,H=a.reset,p=a.register,e=a.formState,q=a.watch,b=q("file"),s=b&&b.length?URL.createObjectURL(b[0]):"https://via.placeholder.com/320x256?text=Upload+Image",t=(0,u.useRef)(null);return(0,k.jsx)("label",{ref:t,htmlFor:f,className:"modal cursor-pointer",children:(0,k.jsxs)("label",{htmlFor:"",className:"modal-box relative",children:[(0,k.jsxs)("h3",{className:"text-lg font-bold",children:["Mint a new NFT",d?" with parent #".concat(d):""]}),(0,k.jsxs)("form",{action:"",className:"mt-4 flex flex-col gap-2",onSubmit:o((l=(0,g.Z)(j().mark(function a(b){var c,e,f,g,k,l,m,o,p,q,r;return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=3,B(F.account.meta.source);case 3:return f=a.sent,a.next=6,null===(c=f.signer.signRaw)|| void 0===c?void 0:c.call(f.signer,{address:F.account.address,type:"bytes",data:F.account.address});case 6:if(g=a.sent){a.next=9;break}return a.abrupt("return");case 9:return k="sub-".concat(F.account.address,":").concat(null==g?void 0:g.signature),l="https://crustipfs.xyz",m=(0,y.Ue)({url:"".concat(l,"/api/v0"),headers:{authorization:"Basic ".concat(A.from(k).toString("base64"))}}),a.next=14,m.add(b.file[0]);case 14:return o=a.sent.cid,console.log("IPFS CID",o),p={ipfsJson:JSON.stringify({ipfsImage:o.toString(),type:"image"})},q=d?{owner:{Ethereum:G.helper.util.getNestingTokenAddress(C,d)}}:{},a.next=20,G.mintNFTToken((0,i.Z)((0,h.Z)({},q),{collectionId:C,constData:p,properties:[{key:"imageUrl",value:"".concat(l,"/ipfs/").concat(o.toString())},]}));case 20:if(r=a.sent.tokenId,d){a.next=24;break}return a.next=24,(0,n.ET)((0,n.hJ)(E,"root-tokens"),{tokenId:r,collectionId:C});case 24:H(),null===(e=t.current)|| void 0===e||e.click(),D(r);case 27:case"end":return a.stop()}},a)})),function(a){return l.apply(this,arguments)})),children:[(0,k.jsx)("div",{className:"m-auto w-80 h-64 bg-center bg-no-repeat bg-contain",style:{backgroundImage:"url(".concat(s,")")}}),(0,k.jsx)("input",(0,h.Z)({type:"file",accept:"image/*",className:"input"},p("file",{required:{value:!0,message:"Please upload an image"}}))),(0,k.jsx)("div",{className:"flex flex-row justify-end",children:(0,k.jsx)("button",{type:"submit",className:x()("btn btn-primary",{loading:e.isSubmitting,"btn-disabled":!b||!b.length}),children:e.isSubmitting?"Minting":"Mint NFT"})})]})]})})},D=a(60424).web3FromSource;function E(a,b){return F.apply(this,arguments)}function F(){return(F=(0,g.Z)(j().mark(function a(b,c){var d,e,f;return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=b.collectionId,e=c.util.getNestingTokenAddress(d,b.tokenId),a.next=4,c.getCollectionTokensByAddress(d,{Ethereum:e});case 4:return f=a.sent,a.t0="#".concat(b.tokenId),a.t1=b,a.next=9,Promise.all(f.map(function(){var a=(0,g.Z)(j().mark(function a(b){var e;return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e=c.getCollectionTokenObject(d,b),a.next=3,E(e,c);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}},a)}));return function(b){return a.apply(this,arguments)}}()));case 9:return a.t2=a.sent,a.abrupt("return",{name:a.t0,token:a.t1,children:a.t2});case 11:case"end":return a.stop()}},a)}))).apply(this,arguments)}var G=function(){var x,L=(0,w.CU)(),y=(0,m.useRouter)(),W=(0,v.Yk)(),M=(0,r.ZO)(),a=String(y.query.cid||""),N=String(y.query.tid||""),z=(0,r.MH)(a),c=(0,r.lD)(a,N),A=(0,u.useState)(0),d=A[0],X=A[1],Y=(0,u.useCallback)(function(){return X(d+1)},[d]),B=(0,u.useState)(""),O=B[0],Z=B[1],P=(0,u.useCallback)(function(){return z.getData()},[d,z]),F=(0,s.N)(P),Q=(0,u.useCallback)((0,g.Z)(j().mark(function a(){return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",null==c?void 0:c.getData());case 1:case"end":return a.stop()}},a)})),[d,c]),G=(0,s.N)(Q),R=(0,u.useCallback)((0,g.Z)(j().mark(function b(){var c,d,e;return j().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,(0,n.PL)((0,n.IO)((0,n.hJ)(L,"root-tokens"),(0,n.ar)("collectionId","==",a)));case 2:return c=b.sent,d=[],c.forEach(function(a){d.push(a.data().tokenId)}),b.next=7,Promise.all(d.map(function(a){return z.getTokenObject(a)}));case 7:return e=b.sent,b.next=10,Promise.all(e.map(function(a){return E(a,M.helper)}));case 10:return b.abrupt("return",b.sent);case 11:case"end":return b.stop()}},b)})),[d,M,L,a,z]),H=(0,s.N)(R),S=(0,u.useMemo)(function(){if(!H.data)return[];var a=[],b=function(c){a.push(c.token.tokenId),c.children.forEach(function(a){return b(a)})};return H.data.forEach(function(a){return b(a)}),a},[H]),T=(0,u.useMemo)(function(){if(G.data&&G.data.owner.Ethereum){var a=G.data.owner.Ethereum;return parseInt(a.slice(a.length-8,a.length),10)}return""},[G]);if(F.loading)return(0,k.jsx)(t.p,{});var I,J,e,f,U,K,V,b=F.data;return(0,k.jsxs)("div",{className:"m-auto mt-12 mb-20 w-full max-w-6xl",children:[(0,k.jsxs)("div",{className:"prose",children:[(0,k.jsx)("h1",{className:"mb-4",children:b.name}),(0,k.jsx)("div",{className:"flex flex-row justify-between items-center",children:(0,k.jsxs)("span",{children:["ID: ",a," (",b.raw.tokenPrefix,")"]})}),(0,k.jsxs)("div",{className:"not-prose flex flex-row gap-2 text-sm",children:[(0,k.jsx)("span",{children:"Links:"}),(0,k.jsx)("a",{rel:"noreferrer nofollow",href:"https://uniquescan.io/OPAL/collections/".concat(a),target:"_blank",className:"link",children:"UniqueScan"}),(0,k.jsx)("a",{rel:"noreferrer nofollow",href:"https://wallet-opal.unique.network/#/myStuff/nft?collectionId=".concat(a),target:"_blank",className:"link",children:"UniqueWallet"})]}),(0,k.jsx)("p",{children:b.description?b.description:(0,k.jsx)("span",{className:"text-sm text-slate-500",children:"No description provided"})})]}),(0,k.jsx)("div",{className:"flex flex-row justify-end",children:(0,k.jsx)("label",{htmlFor:"mint-nft-modal",className:"btn modal-button btn-primary",onClick:function(){return Z("")},children:"Mint NFT"})}),(0,k.jsx)("input",{type:"checkbox",id:"mint-nft-modal",className:"modal-toggle"}),(0,k.jsx)(C,{collectionId:a,modalInputId:"mint-nft-modal",parentTokenId:O,onMintSuccess:function(a){y.replace({query:(0,i.Z)((0,h.Z)({},y.query),{tid:a})}),Y()}}),(0,k.jsxs)("div",{className:"flex flex-row justify-center items-start gap-8 pt-8",children:[(I=H.data||[],J="#555",e=140,f=p.ZP({name:b.raw.tokenPrefix,children:I}),(0,q.Z)().size([2*Math.PI,e]).separation(function(a,b){return(a.parent==b.parent?1:2)/a.depth})(f),U=o.M4().angle(function(a){return a.x}).radius(function(a){return a.y}),K=f.links(),(0,k.jsxs)("svg",{viewBox:[Math.min(-60-e,-320),Math.min(-60-e,-200),640,400,].join(" "),width:640,height:400,style:{maxWidth:"100%",height:"auto"},fontFamily:"sans-serif",fontSize:"10",onClick:function(){return y.replace({query:{cid:a}})},children:[(0,k.jsx)("g",{fill:"none",stroke:J,strokeOpacity:.4,strokeWidth:1.5,children:K.map(function(a,b){return(0,k.jsx)("path",{d:U(a)},b)})}),(0,k.jsx)("g",{children:f.descendants().map(function(a,d){var b,c;return(0,k.jsx)(l(),{href:{pathname:y.pathname,query:(0,i.Z)((0,h.Z)({},y.query),{tid:null===(b=a.data.token)|| void 0===b?void 0:b.tokenId})},children:(0,k.jsxs)("a",{onClick:function(b){a.data.token&&(b.preventDefault(),b.stopPropagation(),y.replace({pathname:y.pathname,query:(0,i.Z)((0,h.Z)({},y.query),{tid:a.data.token.tokenId})}),y.replace({query:(0,i.Z)((0,h.Z)({},y.query),{tid:a.data.token.tokenId})}))},transform:"rotate(".concat(180*a.x/Math.PI-90,") translate(").concat(a.y,",0)"),children:[(0,k.jsx)("circle",{fill:a.data.children?J:"#999",r:a.data.token?3:9}),N===String(null===(c=a.data.token)|| void 0===c?void 0:c.tokenId)?(0,k.jsx)("circle",{fill:"none",stroke:"#00F604",strokeWidth:"2",r:6}):null,(0,k.jsx)("title",{children:a.data.name}),(0,k.jsx)("text",{transform:"rotate(".concat(a.x>=Math.PI?180:0,")"),x:a.x<Math.PI== !a.data.children?6:-6,dy:"0.32em",textAnchor:a.x<Math.PI== !a.data.children?"start":"end",paintOrder:"stroke",stroke:"#fff",strokeWidth:3,children:a.data.name})]})},d)})})]})),(0,k.jsx)("div",{children:(0,k.jsx)("section",{className:"card shadow-md bg-white w-screen max-w-lg m-auto",children:c?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("figure",{className:"px-10 pt-10",children:(0,k.jsx)("img",{src:(null===(x=G.data)|| void 0===x?void 0:x.properties[0].value)||"https://via.placeholder.com/320x256?text=No+Image",alt:"Shoes",className:"rounded-xl"})}),(0,k.jsxs)("div",{className:"card-body",children:[(0,k.jsxs)("p",{className:"font-bold",children:[(0,k.jsxs)("select",{name:"token-parent",className:"select",value:T,onChange:(V=(0,g.Z)(j().mark(function b(d){var e,f,g,h,i,k,l;return j().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return console.log("CHANGE TO",d.target.value,!!d.target.value),e=d.target.value,b.next=4,D(W.account.meta.source);case 4:if(f=b.sent,g={address:W.account.address,signer:f.signer},!e){b.next=19;break}return h=z.getTokenObject(parseInt(e,10)),b.next=10,c.nest(g,h);case 10:return b.next=12,(0,n.PL)((0,n.IO)((0,n.hJ)(L,"root-tokens"),(0,n.ar)("collectionId","==",a)));case 12:return i=b.sent,k=[],i.forEach(function(a){return k.push((0,n.oe)(a.ref))}),b.next=17,Promise.all(k);case 17:b.next=24;break;case 19:return l=z.getTokenObject(T),b.next=22,c.unnest(g,l,{Substrate:W.account.address});case 22:return b.next=24,(0,n.ET)((0,n.hJ)(L,"root-tokens"),{tokenId:c.tokenId,collectionId:a});case 24:Y();case 25:case"end":return b.stop()}},b)})),function(a){return V.apply(this,arguments)}),children:[(0,k.jsx)("option",{value:"",children:b.raw.tokenPrefix}),S.map(function(a){return String(a)===c.tokenId?null:(0,k.jsxs)("option",{value:a,children:["#",a]})})]}),"\xa0>\xa0",b.raw.tokenPrefix," #",c.tokenId]}),(0,k.jsxs)("div",{className:"flex flex-row gap-2 text-sm",children:[(0,k.jsx)("span",{children:"Links:"}),(0,k.jsx)("a",{rel:"nofollow noreferrer",href:"https://uniquescan.io/OPAL/tokens/".concat(a,"/").concat(c.tokenId),target:"_blank",className:"link",children:"UniqueScan"}),(0,k.jsx)("a",{rel:"nofollow noreferrer",href:"https://wallet-opal.unique.network/#/myStuff/token-details?collectionId=".concat(a,"&tokenId=").concat(c.tokenId),target:"_blank",className:"link",children:"UniqueWallet"})]}),(0,k.jsx)("div",{className:"card-actions justify-end items-center",children:(0,k.jsx)("label",{htmlFor:"mint-nft-modal",className:"btn modal-button btn-primary",onClick:function(){return Z(c.tokenId)},children:"Mint Child"})})]})]}):(0,k.jsx)("span",{className:"m-4 text-sm text-slate-500",children:"No token selected"})})})]})]})}},93293:function(c,b,a){"use strict";a.d(b,{N:function(){return e}});var d=a(67294);function e(b,c,e,f){var a=(0,d.useState)({loading:!0}),g=a[0],h=a[1];return(0,d.useEffect)(function(){h({loading:!0}),b(c,e,f).then(function(a){h({data:a,loading:!1})}).catch(function(a){console.log("FAILED CALL",a),h({loading:!1,error:String(a)})})},[b,c,e,f]),g}},63897:function(){}},function(a){a.O(0,[16,2,536,128,774,888,179],function(){var b;return a(a.s=95380)}),_N_E=a.O()}])